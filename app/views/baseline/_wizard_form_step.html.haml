-# frozen_string_literal: true
-# locals: ()

- content = capture_haml do
  - if current_step
    = form_with model: wizard_resource, url: wizard_path, method: :patch, class: "step-#{current_step.dasherize}", data: data_merge(action_stimco.to_h, turbo_frame: ("modal" if ::Current.modal_request)) do |form|
      - unless ::Current.modal_request
        %h2
          = page_title
      = yield form
      = component :wizard_actions, form:, cancel_url: wizard_cancel_url, show_current_step: show_current_wizard_step, button_color: Baseline::Current.default_button_color
  - else
    = component :modal_close_button, text: t(:got_it), icon: :yes, button_color: Baseline::Current.default_button_color
    = yield

-# If this is rendered in a modal, do not wrap the content in a turbo frame.
-# This would produce nested frames which Turbo cannot handle.
-# Links or forms in the inner frame cannot target the outer frame.
-# https://github.com/hotwired/turbo/issues/1480

- require "turbo/version"
- if Turbo::VERSION > "2.0.20"
  - ReportError.call "Check if this bug is fixed in Turbo #{Turbo::VERSION}."

- if ::Current.modal_request
  = content
- else
  = turbo_frame_tag frame_id do
    = content
